# 프롬프트 및 AI 활용 방법 문서

## 1. 전체 접근 방법

AI(Claude Code)를 활용하여 레거시 코드의 인수 테스트를 작성하는 과정을 **분석 → 시나리오 도출 → Skill 정의 → 테스트 작성** 단계로 진행했다.

```
[1단계] 프로젝트 분석 (AI)
    ↓
[2단계] 사용자 시나리오 도출 (AI + 사람)
    ↓
[3단계] 테스트 대상 선별 (사람)
    ↓
[4단계] Skill 정의 (사람)
    ↓
[5단계] 테스트 코드 작성 (AI + Skill)
    ↓
[6단계] Skill 개선 (AI + 사람)
```

---

## 2. 단계별 AI 활용 방법

### 2.1 프로젝트 분석

**목적:** 프로젝트의 핵심 기능과 도메인 구조를 파악한다.

**프롬프트 전략:** AI에게 프로젝트의 맥락(무엇인가, 왜 분석하는가)을 먼저 제시하고, 출력 형식(보고서)과 저장 위치(REPORT.md)를 명시했다.

```
프롬프트 예시:
- 어떤 프로젝트인가? → 카카오 선물하기 백엔드 프로젝트
- 왜 분석하는가? → 사용자 관점에서 행위를 검증하는 테스트를 작성하기 위함
- 따라서 프로젝트의 핵심 기능을 파악하고, 사용자 행동 시나리오를 도출하고
  리스트업하여 REPORT.md에 보고서를 작성하라.
```

**결과:** AI가 프로젝트 전체를 분석하여 도메인 모델, API 엔드포인트, 사용자 행동 시나리오를 포함한 분석 보고서를 생성했다.

### 2.2 시나리오 정제

**목적:** 1차 분석 결과를 검토하고, 실제 테스트 가능한 시나리오로 정제한다.

**프롬프트 전략:** AI의 1차 결과에서 부족한 부분을 후속 프롬프트로 보완했다.

1. **도메인 개념 이해:** "옵션이 무엇인지 명확하게 이해되지 않았음. 옵션이 무엇인지 상세하게 설명해 주고, 실제 사용 예제도 함께 포함하여 설명해 달라."
2. **테스트 가능 범위 한정:** "일부 기능들은 현재 미지원 상태이다. API로 노출되어 현재 사용자가 수행 가능한 시나리오에 대해서만 정리해야 한다. 구체적인 예외 케이스들에 대한 시나리오도 모두 정리하라."

### 2.3 Skill 정의

**목적:** 테스트 코드 작성을 위한 재사용 가능한 AI Skill을 정의한다.

**접근 방법:** 가장 간단한 시나리오(카테고리 생성)를 먼저 AI에게 맡겨 결과를 확인한 뒤, 문제점을 파악하여 Skill 문서를 점진적으로 개선했다.

### 2.4 테스트 작성

**목적:** 정의된 Skill을 활용하여 AI가 인수 테스트를 작성한다.

**프롬프트 전략:** REPORT.md의 시나리오를 참조하여 구체적인 테스트 작성을 요청했다.

```
프롬프트 예시:
- REPORT.md 파일의 사용자 행동 시나리오 항목에서, 카테고리에 해당되는
  '시나리오 1' 인수 테스트를 작성해줘.
- REPORT.md 파일의 사용자 행동 시나리오 항목에서, 선물에 해당되는
  '시나리오 1~4' 인수 테스트를 작성해줘.
```

---

## 3. Skill 정의

### acceptance-test Skill

Claude Code의 Skill 기능을 활용하여 인수 테스트 작성 패턴을 재사용 가능한 형태로 정의했다.

**파일 위치:** `.claude/skills/acceptance-test/SKILL.md`

**Skill의 핵심 내용:**

| 항목 | 내용 |
|---|---|
| 핵심 원칙 | 기존 소스코드 수정 금지, RestAssured given-when-then 패턴, SQL 기반 데이터 관리 |
| 작업 절차 | 프로젝트 분석 → 의존성 확인 → SQL 작성 → 테스트 작성 → 실행 확인 (5단계) |
| 테스트 구조 | `@SpringBootTest(RANDOM_PORT)` + `@Sql` + RestAssured |
| 명명 규칙 | `[상황]_[행동]하면_[결과]한다` (한글 메서드명) |
| 검증 전략 | HTTP 응답 → 조회 API → DB 직접 조회 (우선순위) |
| 주의사항 | src/main 수정 금지, 테스트용 API 추가 금지, 독립 실행 가능 |

### Skill 발전 과정

Skill은 한 번에 완성된 것이 아니라, 테스트 작성 과정에서 발견된 문제를 반영하여 반복적으로 개선했다.

**1차 작성:** 기본 구조(핵심 원칙, 기술 스택, 작업 절차, 테스트 패턴)를 정의.

**2차 개선 (검증 전략 추가):** AI가 조회 API가 없는 상황에서 간접적인 시나리오로 우회 테스트를 작성하는 문제 발생.
- 예: "재고가 줄어든다"를 "재고가 없을 때 선물하면 예외 발생"으로 간접 검증
- 이를 해결하기 위해 검증 전략 섹션을 추가하여, DB 직접 조회(JdbcTemplate)를 보조 수단으로 허용하는 가이드를 명시
