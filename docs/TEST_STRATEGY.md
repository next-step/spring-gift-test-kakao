# TEST_STRATEGY.md

선물하기 서비스 테스트 전략 문서

---

# 1. 문서 목적

본 문서는 선물하기 서비스의 인수 테스트(Acceptance Test) 작성 및 운영에 대한 전략을 정의한다.
테스트의 일관성, 재현성, 독립성을 보장하고, 불필요한 테스트 작성을 방지하며, 비즈니스 핵심 행위를 중심으로 검증하는 것을 목표로 한다.

---

# 2. 테스트 범위 및 목표

## 2.1 테스트 범위

* API 경계 기반 인수 테스트 (Acceptance Test)
* 주요 비즈니스 행위 검증
* 상태 변화(State Change) 중심 검증
* 실패 시나리오 포함 검증

## 2.2 테스트 목표

* 시스템이 요구된 비즈니스 행위를 정확히 수행함을 증명
* 성공 케이스뿐 아니라 실패 케이스를 통해 견고성 검증
* 테스트 간 간섭이 없는 독립적 실행 보장
* 동일한 결과를 반복 재현 가능하도록 데이터 전략 수립

---

# 3. 검증 대상 행위 목록

Claude가 도출한 기능 목록 중 다음 기준에 따라 테스트 대상을 선정한다.

## 3.1 반드시 테스트해야 하는 행위

* 재고 차감 로직
* 재고 부족 시 요청 실패
* 상품/옵션 생성 및 조회
* 위시리스트 담기
* 선물 생성 및 전달 처리
* 트랜잭션 단위의 상태 변화

## 3.2 테스트 필요성 판단 기준

다음 조건 중 하나 이상을 만족하면 테스트 대상으로 선정한다.

* 비즈니스 핵심 로직에 해당
* 상태 변화가 발생
* 예외 발생 가능성이 존재
* 외부 연동이 포함된 경우
* 사용자 행위에 직접적으로 노출되는 기능

단순 Getter/Setter, 단순 매핑 로직 등은 인수 테스트 대상에서 제외한다.

---

# 4. 테스트 데이터 전략

테스트는 완전한 독립성과 재현성을 보장해야 한다.
각 테스트는 실행 순서에 의존하지 않아야 한다.

## 4.1 데이터 초기화 원칙

* 파일 상단에 반드시 관련 테이블을 TRUNCATE 또는 DELETE 한다.
* 외래키 제약조건을 고려하여 자식 테이블부터 역순으로 삭제한다.
* 모든 테스트는 독립적으로 실행 가능해야 한다.

## 4.2 데이터 삽입 원칙

* 삭제 후 해당 테스트에 필요한 데이터만 INSERT 한다.
* Entity의 실제 테이블명과 컬럼명을 사용한다 (JPA 네이밍 전략 반영).
* NOT NULL 제약조건을 만족하는 완전한 INSERT 문을 작성한다.
* 외래키 순서를 지켜 삽입한다 (부모 테이블 먼저).
* 고정 ID를 사용한다. 랜덤 생성 금지.
* 각 INSERT 문 위에 주석으로 데이터의 용도를 명시한다.

## 4.3 데이터 단위 전략

### 옵션 1: 클래스 단위 데이터 세트

* 테스트 클래스 공통 데이터 구성
* 여러 시나리오에서 재사용 가능
* 유지보수 용이

### 옵션 2: 메서드 단위 데이터 세트

* 각 테스트에 필요한 최소 데이터만 구성
* 테스트 간 결합도 최소화
* 상태 변화 검증에 적합

권장 전략:

* 상태 변화 검증이 중요한 Acceptance Test의 경우 메서드 단위 데이터 세트 권장
* 공통 기준 데이터(카테고리 등)는 클래스 단위 구성 가능

---

# 5. 검증 전략

테스트는 단순 성공 여부 확인이 아닌, 비즈니스 의미를 검증해야 한다.

## 5.1 필수 검증 항목

* HTTP statusCode
* 응답 body (비즈니스 결과 데이터)
* 필요 시 header 검증

## 5.2 상태 변화 검증

* 성공 후 조회 API를 통해 상태 확인
* 실패 시 상태가 변경되지 않았음을 검증
* 재고 감소, 수량 유지, 생성 여부 등을 명확히 확인

## 5.3 실패 시나리오 포함 원칙

모든 주요 행위 테스트는 다음을 포함해야 한다.

* 성공 시나리오 최소 1개
* 실패 시나리오 최소 1개

예시:

* 재고 1개 → 1회 성공 → 2회 요청 시 실패

---

# 6. 주요 의사결정 사항

## 6.1 SQL Script vs Local DB 전략

| 항목   | SQL Script 기반 | Local DB 활용 |
| ---- | ------------- | ----------- |
| 재현성  | 높음            | 높음          |
| 독립성  | 관리 필요         | 환경 의존성 존재   |
| 속도   | 빠름            | 상대적으로 느림    |
| 유지보수 | SQL 증가 시 부담   | 구조적 관리 가능   |

현재 전략:

* SQL Script 기반 데이터 관리 채택
* 테스트 실행 전 초기화 및 명시적 INSERT 전략 유지

## 6.2 테스트 데이터 단위 결정

* 클래스 단위 vs 메서드 단위 전략은 테스트 성격에 따라 선택
* Acceptance Test는 가능하면 메서드 단위 데이터 세트 권장

## 6.3 Claude가 도출한 기능의 테스트 필요성 판단

Claude가 생성한 기능 목록에 대해:

* 비즈니스 핵심인가?
* 상태 변화가 있는가?
* 예외 가능성이 있는가?
* 사용자 행위와 직접 연관되는가?

위 기준을 충족하지 않으면 테스트 대상에서 제외한다.

---

# 7. 테스트 품질 기준

* 실행 순서 독립성 보장
* 고정 ID 사용
* 랜덤 데이터 사용 금지
* 실패 시나리오 포함
* 가독성 있는 테스트 코드 작성
* Given / When / Then 구조 유지
* 상태 변화 명확히 증명

---

# 8. 결론

본 테스트 전략은 다음을 지향한다.

* 비즈니스 행위 중심 검증
* 상태 변화 기반 견고성 증명
* 데이터 독립성 확보
* 재현 가능한 테스트 환경 유지
* 불필요한 테스트 제거 및 핵심 기능 집중
